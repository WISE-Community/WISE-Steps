<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>MySystem </title>
  
  <link rel="icon" href="res/favicon.ico" type="image/png" />
  <link rel="SHORTCUT ICON" href="res/favicon.ico" type="image/png" />

  <!-- YUI CSS files: -->
  <link rel="stylesheet" type="text/css" href="css/YUI/reset-font-grids.css" />
  <link rel="stylesheet" type="text/css" href="css/YUI/base-min.css" />
  <link rel="stylesheet" type="text/css" href="css/YUI/sam.css" />
  
  <!-- WireIt CSS -->
  <link rel="stylesheet" type="text/css" href="css/WireIt.css" />
  <link rel="stylesheet" type="text/css" href="css/WireItEditor.css" />
  <link rel="stylesheet" type="text/css" href="css/mysystem.css" />

  <!-- this version uses some concatentated assetts, generated by the rake task-->
  <script type="text/javascript" src="all.js"></script>
  <!--  <script type="text/javascript" src="mysystem_complete.js"></script> -->


</head>
<body class="yui-skin-sam">

  <script>
  (function() {
	  GradingToolDS = function(_data){
	    this.data = _data;
	    //this.vle = _vle;
	    //this.vleNode=_vle.getCurrentNode();
	    this.enableLoadAndSave = false;
	  };

	  GradingToolDS.prototype = {
	    save: function(_data) {
	        //this.vle.saveState(_data,this.vleNode);
	        this.data = _data;
	    },

	    load: function(context,callback) {
		    debugger;
	      //this.data = this.vle.getLatestStateForCurrentNode();
	      callback(this.data,context);
	    },

	    toString: function() {
	      return "VLE Data Service (" + this.vle + ")";
	    }
	  };

	})();

        var mySystem;
        var myDataService;
        document.observe("dom:loaded", function() {
			debugger;
			/*
        	var data = window.opener.$("#"+divId).html();
        	var contentString = window.opener.$("#content_"+divId).html()
        		
            mysystem.config.dataService = new GradingToolDS(data);
            mysystem.config.jsonURL = contentString;
            mySystem = mysystem.loadMySystem();
			*/

        	var data = window.opener.$("#studentwork_"+divId).html();
        	var contentString = window.opener.$("#content_"+divId).html()
        	var contentUrl = window.opener.$("#contenturl_"+divId).html()
        		
            //mysystem.config.dataService = new GradingToolDS(data);
            //mysystem.config.jsonURL = contentString;
			
          mySystem = new MySystem();
	      mySystem.loadModulesFromJSON(contentString);
	      var myDataService = new GradingToolDS(data);
          //myDataService = new MocDS(null,null);
          // myDataService = new VleDS(vle);
          //myDataService = new RestDS('','');
          // myDataService = new GGearsDS('write','write','mysys');
          //myDataService = new CookieDS(null,'write');
          mySystem.setDataService(myDataService);
          if (mySystem.editor) {
            mySystem.editor.enableLoadAndSave();
          }
          mySystem.load();
        });
        
        onExit = function () {
            debug("saving mystem data before we leave");
            mySystem.save();
            debug("saved!");
        }
      
        // window.onbeforeunload = onExit;

  </script>

  <div id="goal_panel">
    <span id="goal_panel_text"></span>
    <img id="goal_panel_icon"/>
  </div>

  <div id="editing_window">
    <div id="top">
      <div class="logo">MySystem</div>
      <div id="toolbar" style="display:none;"></div>
      <div class="topright">
      </div>
    </div>

    <div id="left"></div>
  
  
      <div id="prop_form" display="hidden">
        <div id="prop_bar">
          <div id="prop_form_closer"></div>
          <h4><span id="prop_name"></span></h4>
        </div>
        <div id="icon_spot"></div>

        <form id="prop_form_form" name="prop_form_form">
          <table id="prop_fields"></table>
        </form>
        <div id="palette"></div>
      </div>

      <div id="center"></div>
    </div> <!-- editing window end -->

  <div id="print_window" style="display:none;width:100%;height:100%;z-index:100;">
    Nothing to see here.  Move along.
    <div class="hd">Printing Canvas (beta)</div>
    <div class="bd" style="text-align: left;">
      <canvas id="printing_canvas" width="300" height="300"></canvas>
    </div>
  </div>

</body>
</html>
