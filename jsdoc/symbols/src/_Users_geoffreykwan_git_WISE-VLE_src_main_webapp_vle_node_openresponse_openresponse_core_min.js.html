<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="NAME">OpenResponseNode.prototype</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Node</span><span class="PUNC">;</span><span class="NAME">OpenResponseNode.prototype.constructor</span><span class="PUNC">=</span><span class="NAME">OpenResponseNode</span><span class="PUNC">;</span><span class="NAME">OpenResponseNode.prototype.parent</span><span class="PUNC">=</span><span class="NAME">Node.prototype</span><span class="PUNC">;</span><span class="NAME">OpenResponseNode.authoringToolName</span><span class="PUNC">=</span><span class="STRN">"Open Response"</span><span class="PUNC">;</span><span class="NAME">OpenResponseNode.authoringToolDescription</span><span class="PUNC">=</span><span class="STRN">"Students write text to answer a question or explain their thoughts"</span><span class="PUNC">;</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">OpenResponseNode</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.view</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">this.type</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">;</span><span class="NAME">this.prevWorkNodeIds</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.exportableToNodes</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">"NoteNode"</span><span class="PUNC">,</span><span class="STRN">"OpenResponseNode"</span><span class="PUNC">,</span><span class="STRN">"SVGDrawNode"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.importableFileExtensions</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">"jpg"</span><span class="PUNC">,</span><span class="STRN">"png"</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="NAME">OpenResponseNode.prototype.parseDataJSONObj</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">OPENRESPONSESTATE.prototype.parseDataJSONObj</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenResponseNode.prototype.translateStudentWork</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenResponseNode.prototype.getPeerReviewPrompt</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.or</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="NAME">this.or</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OPENRESPONSE</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.or.getPeerReviewPrompt</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenResponseNode.prototype.getPeerReviewOtherStudentWork</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.or</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="NAME">this.or</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OPENRESPONSE</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.or.getPeerReviewOtherStudentWork</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  3</span> </span><span class="NAME">OpenResponseNode.prototype.canExportWork</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.exportableToNodes</span><span class="PUNC">&&</span><span class="NAME">this.exportableToNodes.indexOf</span><span class="PUNC">(</span><span class="NAME">a.type</span><span class="PUNC">)</span><span class="PUNC">></span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  4</span> </span><span class="NAME">OpenResponseNode.prototype.exportWork</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.canExportWork</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">this.view.state.getNodeVisitsByNodeId</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">b.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">&lt;</span><span class="NAME">b.length</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">&lt;</span><span class="NAME">f.nodeStates.length</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">c.push</span><span class="PUNC">(</span><span class="NAME">f.nodeStates</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">c.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getStudentWork</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.type</span><span class="PUNC">==</span><span class="STRN">"SVGDrawNode"</span><span class="PUNC">?</span><span class="STRN">'&lt;text x="250" y="150" font-family="Verdana" font-size="35" fill="black" >'</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">+</span><span class="STRN">"&lt;/text>"</span><span class="PUNC">:</span><span class="NAME">b</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  5</span> </span><span class="NAME">OpenResponseNode.prototype.importWork</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">a.exportWork</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">this.contentPanel</span><span class="PUNC">&&</span><span class="NAME">this.contentPanel.or</span><span class="PUNC">&&</span><span class="NAME">this.contentPanel.or.appendResponse</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenResponseNode.prototype.canImportFile</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.contentPanel.or.content.isRichTextEditorAllowed</span><span class="PUNC">&&</span><span class="NAME">a.indexOf</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">&&</span><span class="NAME">this.importableFileExtensions.indexOf</span><span class="PUNC">(</span><span class="NAME">a.substr</span><span class="PUNC">(</span><span class="NAME">a.lastIndexOf</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">?</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  6</span> </span><span class="NAME">OpenResponseNode.prototype.importFile</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.canImportFile</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="PUNC">(</span><span class="NAME">this.contentPanel.or.appendResponse</span><span class="PUNC">(</span><span class="STRN">"&lt;img src='"</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">+</span><span class="STRN">"'>&lt;/img>"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenResponseNode.prototype.onExit</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.contentPanel</span><span class="PUNC">&&</span><span class="NAME">this.contentPanel.save</span><span class="PUNC">&&</span><span class="NAME">this.contentPanel.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OpenResponseNode.prototype.getHTMLContentTemplate</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">createContent</span><span class="PUNC">(</span><span class="STRN">"node/openresponse/openresponse.html"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">NodeFactory.addNode</span><span class="PUNC">(</span><span class="STRN">"OpenResponseNode"</span><span class="PUNC">,</span><span class="NAME">OpenResponseNode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  7</span> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">eventManager</span><span class="PUNC">!=</span><span class="STRN">"undefined"</span><span class="PUNC">&&</span><span class="NAME">eventManager.fire</span><span class="PUNC">(</span><span class="STRN">"scriptLoaded"</span><span class="PUNC">,</span><span class="STRN">"vle/node/openresponse/OpenResponseNode.js"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">NoteNode.prototype</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OpenResponseNode</span><span class="PUNC">;</span><span class="NAME">NoteNode.prototype.constructor</span><span class="PUNC">=</span><span class="NAME">NoteNode</span><span class="PUNC">;</span><span class="NAME">NoteNode.prototype.parent</span><span class="PUNC">=</span><span class="NAME">OpenResponseNode.prototype</span><span class="PUNC">;</span><span class="NAME">NoteNode.authoringToolName</span><span class="PUNC">=</span><span class="STRN">"Reflection Note"</span><span class="PUNC">;</span><span class="NAME">NoteNode.authoringToolDescription</span><span class="PUNC">=</span><span class="STRN">"Students write text to answer a question or explain their thoughts"</span><span class="PUNC">;</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">NoteNode</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.view</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">this.type</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">;</span><span class="NAME">this.prevWorkNodeIds</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.exportableToNodes</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">"NoteNode"</span><span class="PUNC">,</span><span class="STRN">"OpenResponseNode"</span><span class="PUNC">,</span><span class="STRN">"SVGDrawNode"</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>  8</span> </span><span class="NAME">NoteNode.prototype.render</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.studentWork</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.baseHtmlContent</span><span class="PUNC">)</span><span class="NAME">this.baseHtmlContent</span><span class="PUNC">=</span><span class="NAME">this.view.getHTMLContentTemplate</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">"#notePanel"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">html</span><span class="PUNC">(</span><span class="NAME">this.injectBaseRef</span><span class="PUNC">(</span><span class="NAME">this.injectKeystrokeManagerScript</span><span class="PUNC">(</span><span class="NAME">this.view.injectVleUrl</span><span class="PUNC">(</span><span class="NAME">this.baseHtmlContent.getContentString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.view.activeNote</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OPENRESPONSE</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.view</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.view.activeNote.content.isRichTextEditorAllowed</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">this.view.activeNote.render</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">"#notePanel"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">dialog</span><span class="PUNC">(</span><span class="STRN">"open"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">".ui-draggable"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">draggable</span><span class="PUNC">(</span><span class="STRN">"option"</span><span class="PUNC">,</span><span class="STRN">"iframeFix"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>  9</span> </span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">".ui-draggable"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">resizable</span><span class="PUNC">(</span><span class="STRN">"option"</span><span class="PUNC">,</span><span class="STRN">"ghost"</span><span class="PUNC">,</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">NoteNode.prototype.onExit</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.view.activeNote</span><span class="PUNC">&&</span><span class="NAME">this.view.activeNote.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">NoteNode.prototype.canExportWork</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.exportableToNodes</span><span class="PUNC">&&</span><span class="NAME">this.exportableToNodes.indexOf</span><span class="PUNC">(</span><span class="NAME">a.type</span><span class="PUNC">)</span><span class="PUNC">></span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 10</span> </span><span class="NAME">NoteNode.prototype.exportWork</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.canExportWork</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">this.view.state.getNodeVisitsByNodeId</span><span class="PUNC">(</span><span class="NAME">this.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">b.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">&lt;</span><span class="NAME">b.length</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">&lt;</span><span class="NAME">f.nodeStates.length</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">c.push</span><span class="PUNC">(</span><span class="NAME">f.nodeStates</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">c.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getStudentWork</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.type</span><span class="PUNC">==</span><span class="STRN">"SVGDrawNode"</span><span class="PUNC">?</span><span class="STRN">'&lt;text x="250" y="150" font-family="Verdana" font-size="35" fill="black" >'</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">+</span><span class="STRN">"&lt;/text>"</span><span class="PUNC">:</span><span class="NAME">b</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 11</span> </span><span class="NAME">NoteNode.prototype.importWork</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">a.exportWork</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">this.view</span><span class="PUNC">&&</span><span class="NAME">this.view.activeNote</span><span class="PUNC">&&</span><span class="NAME">this.view.activeNote.appendResponse</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">NoteNode.prototype.getHTMLContentTemplate</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">createContent</span><span class="PUNC">(</span><span class="STRN">"node/openresponse/note.html"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">NodeFactory.addNode</span><span class="PUNC">(</span><span class="STRN">"NoteNode"</span><span class="PUNC">,</span><span class="NAME">NoteNode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">eventManager</span><span class="PUNC">!=</span><span class="STRN">"undefined"</span><span class="PUNC">&&</span><span class="NAME">eventManager.fire</span><span class="PUNC">(</span><span class="STRN">"scriptLoaded"</span><span class="PUNC">,</span><span class="STRN">"vle/node/openresponse/NoteNode.js"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">View.prototype.openResponseDispatcher</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">a</span><span class="PUNC">==</span><span class="STRN">"openResponsePromptChanged"</span><span class="PUNC">?</span><span class="NAME">c.OpenResponseNode.updatePrompt</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">a</span><span class="PUNC">==</span><span class="STRN">"openResponseStarterOptionChanged"</span><span class="PUNC">?</span><span class="NAME">c.OpenResponseNode.starterChanged</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">a</span><span class="PUNC">==</span><span class="STRN">"openResponseStarterSentenceUpdated"</span><span class="PUNC">?</span><span class="NAME">c.OpenResponseNode.starterUpdated</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">a</span><span class="PUNC">==</span><span class="STRN">"openResponseUpdateRichText"</span><span class="PUNC">?</span><span class="NAME">c.OpenResponseNode.updateRichText</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">a</span><span class="PUNC">==</span><span class="STRN">"openResponseLinesChanged"</span><span class="PUNC">?</span><span class="NAME">c.OpenResponseNode.linesUpdated</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">a</span><span class="PUNC">==</span><span class="STRN">"openResponsePeerReviewAuthoredWorkUpdated"</span><span class="PUNC">?</span><span class="NAME">c.OpenResponseNode.peerReviewAuthoredWorkUpdated</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">a</span><span class="PUNC">==</span><span class="WHIT">
<span class='line'> 12</span> </span><span class="STRN">"openResponsePeerReviewPercentageTriggerUpdated"</span><span class="PUNC">?</span><span class="NAME">c.OpenResponseNode.peerReviewPercentageTriggerUpdated</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">a</span><span class="PUNC">==</span><span class="STRN">"openResponsePeerReviewNumberTriggerUpdated"</span><span class="PUNC">?</span><span class="NAME">c.OpenResponseNode.peerReviewNumberTriggerUpdated</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">a</span><span class="PUNC">==</span><span class="STRN">"openResponsePeerReviewAuthoredReviewUpdated"</span><span class="PUNC">?</span><span class="NAME">c.OpenResponseNode.peerReviewAuthoredReviewUpdated</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">a</span><span class="PUNC">==</span><span class="STRN">"openResponsePeerReviewStepNotOpenCustomMessageUpdated"</span><span class="PUNC">&&</span><span class="NAME">c.OpenResponseNode.peerReviewStepNotOpenCustomMessageUpdated</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 13</span> </span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">events</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">"openResponsePromptChanged"</span><span class="PUNC">,</span><span class="STRN">"openResponseStarterOptionChanged"</span><span class="PUNC">,</span><span class="STRN">"openResponseStarterSentenceUpdated"</span><span class="PUNC">,</span><span class="STRN">"openResponseUpdateRichText"</span><span class="PUNC">,</span><span class="STRN">"openResponseLinesChanged"</span><span class="PUNC">,</span><span class="STRN">"openResponsePeerReviewAuthoredWorkUpdated"</span><span class="PUNC">,</span><span class="STRN">"openResponsePeerReviewPercentageTriggerUpdated"</span><span class="PUNC">,</span><span class="STRN">"openResponsePeerReviewNumberTriggerUpdated"</span><span class="PUNC">,</span><span class="STRN">"openResponsePeerReviewAuthoredReviewUpdated"</span><span class="PUNC">,</span><span class="STRN">"openResponsePeerReviewStepNotOpenCustomMessageUpdated"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="NAME">events.length</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">componentloader.addEvent</span><span class="PUNC">(</span><span class="NAME">events</span><span class="PUNC">[</span><span class="NAME">x</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="STRN">"openResponseDispatcher"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 14</span> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">eventManager</span><span class="PUNC">!=</span><span class="STRN">"undefined"</span><span class="PUNC">&&</span><span class="NAME">eventManager.fire</span><span class="PUNC">(</span><span class="STRN">"scriptLoaded"</span><span class="PUNC">,</span><span class="STRN">"vle/node/openresponse/openResponseEvents.js"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">OPENRESPONSESTATE</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.type</span><span class="PUNC">=</span><span class="STRN">"or"</span><span class="PUNC">;</span><span class="NAME">this.response</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">;</span><span class="NAME">this.timestamp</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">?</span><span class="NAME">b</span><span class="PUNC">:</span><span class="NAME">Date.parse</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.locked</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this.submitPeerReview</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">}</span><span class="NAME">OPENRESPONSESTATE.prototype.print</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OPENRESPONSESTATE.prototype.getHtml</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"timestamp: "</span><span class="PUNC">+</span><span class="NAME">this.timestamp</span><span class="PUNC">+</span><span class="STRN">"&lt;br/>response: "</span><span class="PUNC">+</span><span class="NAME">this.response</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OPENRESPONSESTATE.prototype.parseDataJSONObj</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OPENRESPONSESTATE</span><span class="PUNC">(</span><span class="NAME">a.response</span><span class="PUNC">,</span><span class="NAME">a.timestamp</span><span class="PUNC">,</span><span class="NAME">a.locked</span><span class="PUNC">,</span><span class="NAME">a.submitPeerReview</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 15</span> </span><span class="NAME">OPENRESPONSESTATE.prototype.getStudentWork</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">this.response</span><span class="PUNC">;</span><span class="NAME">this.response</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">this.response.constructor.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">"Array"</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">this.response.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OPENRESPONSESTATE.prototype.isLocked</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.locked</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">eventManager</span><span class="PUNC">!=</span><span class="STRN">"undefined"</span><span class="PUNC">&&</span><span class="NAME">eventManager.fire</span><span class="PUNC">(</span><span class="STRN">"scriptLoaded"</span><span class="PUNC">,</span><span class="STRN">"vle/node/openresponse/openresponsestate.js"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">OPENRESPONSE</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.node</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">;</span><span class="NAME">this.view</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">this.content</span><span class="PUNC">=</span><span class="NAME">a.getContent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getContentJSON</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.states</span><span class="PUNC">=</span><span class="NAME">a.studentWork</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NAME">a.studentWork</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.node.associatedStartNode</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.associatedStartNodeId</span><span class="PUNC">=</span><span class="NAME">this.node.associatedStartNode</span><span class="PUNC">,</span><span class="NAME">this.associatedStartNode</span><span class="PUNC">=</span><span class="NAME">this.view.getProject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getNodeById</span><span class="PUNC">(</span><span class="NAME">this.associatedStartNodeId</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.associatedStartNode</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="NAME">this.associatedStartNodeContent</span><span class="PUNC">=</span><span class="NAME">this.associatedStartNode.getContent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getContentJSON</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.node.associatedAnnotateNode</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.associatedAnnotateNodeId</span><span class="PUNC">=</span><span class="WHIT">
<span class='line'> 16</span> </span><span class="NAME">this.node.associatedAnnotateNode</span><span class="PUNC">,</span><span class="NAME">this.associatedAnnotateNode</span><span class="PUNC">=</span><span class="NAME">this.view.getProject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getNodeById</span><span class="PUNC">(</span><span class="NAME">this.associatedAnnotateNodeId</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.associatedAnnotateNode</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="NAME">this.associatedAnnotateNodeContent</span><span class="PUNC">=</span><span class="NAME">this.associatedAnnotateNode.getContent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getContentJSON</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.node.peerReview</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.otherStudentNodeVisit</span><span class="PUNC">=</span><span class="NAME">this.otherStudentStepWorkId</span><span class="PUNC">=</span><span class="NAME">this.otherStudentWorkgroupId</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">this.showAuthorContent</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">this.annotation</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">this.node.peerReview</span><span class="PUNC">==</span><span class="STRN">"annotate"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="NAME">this.openPercentageTrigger</span><span class="PUNC">=</span><span class="NAME">this.content.openPercentageTrigger</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 17</span> </span><span class="NAME">this.openNumberTrigger</span><span class="PUNC">=</span><span class="NAME">this.content.openNumberTrigger</span><span class="PUNC">,</span><span class="NAME">this.openLogicTrigger</span><span class="PUNC">=</span><span class="NAME">this.content.openLogicTrigger</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.node.peerReview</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">||</span><span class="NAME">this.node.teacherReview</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="NAME">this.node.setIsPartOfReviewSequence</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.stepNotOpenCustomMessage</span><span class="PUNC">=</span><span class="NAME">this.content.stepNotOpenCustomMessage</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.view</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">this.view.isLatestNodeStateLocked</span><span class="PUNC">&&</span><span class="NAME">this.view.isLatestNodeStateLocked</span><span class="PUNC">(</span><span class="NAME">this.node.id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="NAME">this.locked</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.node.setCompleted</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">eventManager.subscribe</span><span class="PUNC">(</span><span class="STRN">"getAnnotationsComplete"</span><span class="PUNC">,</span><span class="NAME">this.getAnnotationsComplete</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 18</span> </span><span class="NAME">OPENRESPONSE.prototype.isLocked</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">&lt;</span><span class="NAME">this.states.length</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.states</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">locked</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OPENRESPONSE.prototype.getResponse</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">this.richTextEditor</span><span class="PUNC">?</span><span class="NAME">this.richTextEditor.getContent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"responseBox"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 19</span> </span><span class="NAME">OPENRESPONSE.prototype.save</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isSaveAvailable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">this.isSaveAndLockAvailable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">this.getResponse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isResponseChanged</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">OPENRESPONSESTATE</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">b</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">&&</span><span class="NAME">confirm</span><span class="PUNC">(</span><span class="STRN">"You will not be able to make further edits after submitting this response.  Ready to submit?"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.node.peerReview</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">this.node.peerReview</span><span class="PUNC">==</span><span class="STRN">"start"</span><span class="PUNC">)</span><span class="NAME">c.submitForPeerReview</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">c.locked</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">this.lockResponseBox</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setSaveAndLockUnavailable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.locked</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">this.node.setCompleted</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.node.peerReview</span><span class="PUNC">!=</span><span class="WHIT">
<span class='line'> 20</span> </span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">this.node.peerReview</span><span class="PUNC">==</span><span class="STRN">"annotate"</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">this.showAuthorContent</span><span class="PUNC">&&</span><span class="NAME">this.postAnnotation</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">this.node.peerReview</span><span class="PUNC">==</span><span class="STRN">"revise"</span><span class="PUNC">||</span><span class="NAME">this.node.teacherReview</span><span class="PUNC">==</span><span class="STRN">"revise"</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">this.node.setCompleted</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">eventManager.fire</span><span class="PUNC">(</span><span class="STRN">"pushStudentWork"</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.states.push</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">this.setSaveUnavailable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 21</span> </span><span class="NAME">OPENRESPONSE.prototype.postAnnotation</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">this.view.getConfig</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getConfigParam</span><span class="PUNC">(</span><span class="STRN">"runId"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">this.otherStudentNodeVisit.nodeId</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">this.otherStudentWorkgroupId</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">this.view.getUserAndClassInfo</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getWorkgroupId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">this.otherStudentStepWorkId</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">this.view.getUserAndClassInfo</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getPeriodId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">this.view.getConfig</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getConfigParam</span><span class="PUNC">(</span><span class="STRN">"postAnnotationsUrl"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">runId</span><span class="PUNC">:</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">nodeId</span><span class="PUNC">:</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">toWorkgroup</span><span class="PUNC">:</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">fromWorkgroup</span><span class="PUNC">:</span><span class="NAME">f</span><span class="PUNC">,</span><span class="NAME">annotationType</span><span class="PUNC">:</span><span class="STRN">"comment"</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">:</span><span class="NAME">encodeURIComponent</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">stepWorkId</span><span class="PUNC">:</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">action</span><span class="PUNC">:</span><span class="STRN">"peerReviewAnnotate"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 22</span> </span><span class="NAME">periodId</span><span class="PUNC">:</span><span class="NAME">g</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.view.annotations</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="NAME">this.view.annotations</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Annotations</span><span class="PUNC">;</span><span class="NAME">this.view.annotations.updateOrAddAnnotation</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Annotation</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">,</span><span class="STRN">"comment"</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.view.connectionManager.request</span><span class="PUNC">(</span><span class="STRN">"POST"</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OPENRESPONSE.prototype.saveAndLock</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.save</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OPENRESPONSE.prototype.responseEdited</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setSaveAvailable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">displayNumberAttempts</span><span class="PUNC">(</span><span class="STRN">"This is your"</span><span class="PUNC">,</span><span class="STRN">"revision"</span><span class="PUNC">,</span><span class="NAME">this.states</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OPENRESPONSE.prototype.setSaveAvailable</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">"#saveButton"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">parent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">removeClass</span><span class="PUNC">(</span><span class="STRN">"ui-state-disabled"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 23</span> </span><span class="NAME">OPENRESPONSE.prototype.setSaveUnavailable</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">"#saveButton"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">parent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">"ui-state-disabled"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OPENRESPONSE.prototype.isSaveAvailable</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">!</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">"#saveButton"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">parent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">hasClass</span><span class="PUNC">(</span><span class="STRN">"ui-state-disabled"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OPENRESPONSE.prototype.setSaveAndLockAvailable</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">"#saveAndLockButton"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">parent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">removeClass</span><span class="PUNC">(</span><span class="STRN">"ui-state-disabled"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OPENRESPONSE.prototype.setSaveAndLockUnavailable</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">"#saveAndLockButton"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">parent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="STRN">"ui-state-disabled"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 24</span> </span><span class="NAME">OPENRESPONSE.prototype.isSaveAndLockAvailable</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">!</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">"#saveAndLockButton"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">parent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">hasClass</span><span class="PUNC">(</span><span class="STRN">"ui-state-disabled"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OPENRESPONSE.prototype.isResponseChanged</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">this.states</span><span class="PUNC">[</span><span class="NAME">this.states.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">a.response</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">this.getResponse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">!=</span><span class="NAME">a</span><span class="PUNC">?</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 25</span> </span><span class="NAME">OPENRESPONSE.prototype.hideAll</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"promptDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"originalPromptDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"annotationDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"starterParent"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"responseDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"buttonDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="WHIT">
<span class='line'> 26</span> </span><span class="STRN">"none"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OPENRESPONSE.prototype.onlyDisplayMessage</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.node.setStepClosed</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.hideAll</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"promptDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"promptLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"orPromptDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 27</span> </span><span class="NAME">OPENRESPONSE.prototype.render</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.node.peerReview</span><span class="PUNC">==</span><span class="STRN">"annotate"</span><span class="PUNC">||</span><span class="NAME">this.node.teacherReview</span><span class="PUNC">==</span><span class="STRN">"annotate"</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">this.locked</span><span class="PUNC">)</span><span class="NAME">this.setSaveUnavailable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.setSaveAndLockUnavailable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.onlyDisplayMessage</span><span class="PUNC">(</span><span class="STRN">"&lt;p>You have successfully reviewed the work submitted by &lt;i>Team Anonymous&lt;/i>.&lt;/p>&lt;p>Well done!&lt;/p>"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.node.peerReview</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">||</span><span class="NAME">this.node.teacherReview</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.node.peerReview</span><span class="PUNC">==</span><span class="STRN">"start"</span><span class="PUNC">||</span><span class="NAME">this.node.peerReview</span><span class="PUNC">==</span><span class="STRN">"annotate"</span><span class="PUNC">||</span><span class="NAME">this.node.teacherReview</span><span class="PUNC">==</span><span class="STRN">"start"</span><span class="PUNC">||</span><span class="NAME">this.node.teacherReview</span><span class="PUNC">==</span><span class="WHIT">
<span class='line'> 28</span> </span><span class="STRN">"annotate"</span><span class="PUNC">)</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"saveAndLockButtonDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.view</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">this.view.activeNode</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.displayRegular</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.node.peerReview</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">||</span><span class="NAME">this.node.teacherReview</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.node.peerReview</span><span class="PUNC">==</span><span class="STRN">"start"</span><span class="PUNC">||</span><span class="NAME">this.node.peerReview</span><span class="PUNC">==</span><span class="STRN">"annotate"</span><span class="PUNC">||</span><span class="NAME">this.node.teacherReview</span><span class="PUNC">==</span><span class="STRN">"start"</span><span class="PUNC">||</span><span class="NAME">this.node.teacherReview</span><span class="PUNC">==</span><span class="STRN">"annotate"</span><span class="PUNC">)</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"saveAndLockButtonDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.node.peerReview</span><span class="PUNC">==</span><span class="STRN">"annotate"</span><span class="PUNC">||</span><span class="NAME">this.node.teacherReview</span><span class="PUNC">==</span><span class="STRN">"annotate"</span><span class="PUNC">)</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"promptLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="WHIT">
<span class='line'> 29</span> </span><span class="STRN">"instructions"</span><span class="PUNC">,</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"responseLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"your feedback for &lt;i>Team Anonymous&lt;/i>:"</span><span class="PUNC">,</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"originalPromptTextDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"[Prompt from the first peer review step will display here]"</span><span class="PUNC">,</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"originalPromptDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">,</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"work submitted by &lt;i>Team Anonymous&lt;/i>:"</span><span class="PUNC">,</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkTextDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"[Work from a random classmate will display here]"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 30</span> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.node.peerReview</span><span class="PUNC">==</span><span class="STRN">"revise"</span><span class="PUNC">||</span><span class="NAME">this.node.teacherReview</span><span class="PUNC">==</span><span class="STRN">"revise"</span><span class="PUNC">)</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"promptLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"instructions"</span><span class="PUNC">,</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"responseLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"your second draft:"</span><span class="PUNC">,</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"originalPromptTextDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"[Prompt from the first peer review step will display here]"</span><span class="PUNC">,</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"originalPromptDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">,</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="WHIT">
<span class='line'> 31</span> </span><span class="STRN">'your original response&nbsp;&nbsp;&nbsp;&lt;a id="toggleSwitch" onclick="toggleDetails2()">show/hide text'</span><span class="PUNC">,</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkTextDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"[Student's work from first peer review step will display here]"</span><span class="PUNC">,</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">,</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkTextDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"none"</span><span class="PUNC">,</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkTextDiv2"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">,</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"annotationLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="WHIT">
<span class='line'> 32</span> </span><span class="STRN">"&lt;i>Team Anonymous&lt;/i> has given you the following feedback:"</span><span class="PUNC">,</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"annotationTextDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"[Feedback from classmate or teacher will display here]"</span><span class="PUNC">,</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"annotationDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.associatedStartNode</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NAME">this.node.peerReview</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NAME">this.node.peerReview</span><span class="PUNC">==</span><span class="STRN">"annotate"</span><span class="PUNC">?</span><span class="NAME">this.view.getConfig</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getConfigParam</span><span class="PUNC">(</span><span class="STRN">"mode"</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">"run"</span><span class="PUNC">&&</span><span class="NAME">this.retrieveOtherStudentWork</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">this.node.peerReview</span><span class="PUNC">==</span><span class="STRN">"revise"</span><span class="PUNC">&&</span><span class="NAME">this.view.getConfig</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getConfigParam</span><span class="PUNC">(</span><span class="STRN">"mode"</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="WHIT">
<span class='line'> 33</span> </span><span class="STRN">"run"</span><span class="PUNC">&&</span><span class="NAME">this.retrieveAnnotationAndWork</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">this.node.teacherReview</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.node.teacherReview</span><span class="PUNC">==</span><span class="STRN">"annotate"</span><span class="PUNC">?</span><span class="NAME">this.displayTeacherWork</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">this.node.teacherReview</span><span class="PUNC">==</span><span class="STRN">"revise"</span><span class="PUNC">&&</span><span class="NAME">this.view.getConfig</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getConfigParam</span><span class="PUNC">(</span><span class="STRN">"mode"</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">"run"</span><span class="PUNC">&&</span><span class="NAME">this.retrieveTeacherReview</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">this.displayRegular</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.locked</span><span class="PUNC">?</span><span class="PUNC">(</span><span class="NAME">this.lockResponseBox</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.setSaveAndLockUnavailable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">this.setSaveAndLockAvailable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 34</span> </span><span class="NAME">OPENRESPONSE.prototype.displayRegular</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.showDefaultDivs</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.showDefaultValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setResponse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.content.isRichTextEditorAllowed</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">window.location.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">a.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">a.indexOf</span><span class="PUNC">(</span><span class="STRN">"/vle/"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"/vle/"</span><span class="PUNC">;</span><span class="NAME">this.richTextEditor</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">tinymce.Editor</span><span class="PUNC">(</span><span class="STRN">"responseBox"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">theme</span><span class="PUNC">:</span><span class="STRN">"advanced"</span><span class="PUNC">,</span><span class="NAME">plugins</span><span class="PUNC">:</span><span class="STRN">"safari,emotions"</span><span class="PUNC">,</span><span class="NAME">theme_advanced_buttons1</span><span class="PUNC">:</span><span class="STRN">"bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,bullist,numlist,|,emotions,|,forecolor,backcolor,|,formatselect,fontselect,fontsizeselect"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 35</span> </span><span class="NAME">theme_advanced_buttons2</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">theme_advanced_buttons3</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">relative_urls</span><span class="PUNC">:</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">remove_script_host</span><span class="PUNC">:</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">document_base_url</span><span class="PUNC">:</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">theme_advanced_toolbar_location</span><span class="PUNC">:</span><span class="STRN">"top"</span><span class="PUNC">,</span><span class="NAME">theme_advanced_toolbar_align</span><span class="PUNC">:</span><span class="STRN">"left"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.richTextEditor.onKeyPress.add</span><span class="PUNC">(</span><span class="NAME">this.responseEdited</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.richTextEditor.render</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">this.doneRendering</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 36</span> </span><span class="NAME">OPENRESPONSE.prototype.displayTeacherWork</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.view.isLatestNodeStateLocked</span><span class="PUNC">(</span><span class="NAME">this.associatedStartNode.id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">this.content.authoredWork</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">this.replaceSlashNWithBR</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.showDefaultDivs</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.showDefaultValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"promptLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"instructions"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"responseLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"your feedback for &lt;i>Team Anonymous&lt;/i>:"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"originalPromptTextDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="NAME">this.associatedStartNode.getPeerReviewPrompt</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"originalPromptDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="WHIT">
<span class='line'> 37</span> </span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"work submitted by &lt;i>Team Anonymous&lt;/i>:"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkTextDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="NAME">this.setResponse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.onlyDisplayMessage</span><span class="PUNC">(</span><span class="STRN">"&lt;p>To start this step you must first submit a response in step &lt;b>&lt;a style=\"color:blue\" onclick=\"eventManager.fire('renderNode', ['"</span><span class="PUNC">+</span><span class="NAME">this.view.getProject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getPositionById</span><span class="PUNC">(</span><span class="NAME">this.associatedStartNode.id</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"']) \">"</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'> 38</span> </span><span class="NAME">this.view.getProject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getStepNumberAndTitle</span><span class="PUNC">(</span><span class="NAME">this.associatedStartNode.id</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"&lt;/a>&lt;/b> (link).&lt;/p>"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.doneRendering</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OPENRESPONSE.prototype.getAnnotationsComplete</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">c.node.id</span><span class="PUNC">&&</span><span class="NAME">c.displayTeacherReview</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 39</span> </span><span class="NAME">OPENRESPONSE.prototype.displayTeacherReview</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">this.view.isLatestNodeStateLocked</span><span class="PUNC">(</span><span class="NAME">this.associatedStartNode.id</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">this.view.isLatestNodeStateLocked</span><span class="PUNC">(</span><span class="NAME">this.associatedAnnotateNode.id</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="NAME">thisOr.associatedStartNode</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">thisOr.view.getProject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getStepNumberAndTitle</span><span class="PUNC">(</span><span class="NAME">thisOr.associatedStartNode.id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="NAME">thisOr.associatedAnnotateNode</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">thisOr.view.getProject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getStepNumberAndTitle</span><span class="PUNC">(</span><span class="NAME">thisOr.associatedAnnotateNode.id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">a</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.view.annotations</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">this.view.annotations.getLatestAnnotation</span><span class="PUNC">(</span><span class="NAME">this.view.getConfig</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getConfigParam</span><span class="PUNC">(</span><span class="STRN">"runId"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 40</span> </span><span class="NAME">this.associatedStartNode.id</span><span class="PUNC">,</span><span class="NAME">this.view.getUserAndClassInfo</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getWorkgroupId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.view.getUserAndClassInfo</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getAllTeacherWorkgroupIds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">"comment"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.onlyDisplayMessage</span><span class="PUNC">(</span><span class="STRN">'&lt;p>Your teacher has not yet reviewed the response you submitted in step &lt;b>"'</span><span class="PUNC">+</span><span class="NAME">c</span><span class="PUNC">+</span><span class="STRN">'"&lt;/b> yet.&lt;/p>&lt;p>Please return to this step again later.&lt;/p>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.doneRendering</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">this.replaceSlashNWithBR</span><span class="PUNC">(</span><span class="NAME">a.value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">this.view.getLatestStateForNode</span><span class="PUNC">(</span><span class="NAME">this.associatedStartNode.id</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">response</span><span class="PUNC">;</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">this.replaceSlashNWithBR</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.showDefaultDivs</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 41</span> </span><span class="NAME">this.showDefaultValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"promptLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"instructions"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"responseLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"your second draft:"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"originalPromptTextDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="NAME">this.associatedStartNodeContent.assessmentItem.interaction.prompt</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"originalPromptDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">'your first response to the question&nbsp;&nbsp;&lt;a id="toggleSwitch" onclick="toggleDetails2()">show/hide text'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 42</span> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkTextDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkTextDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkTextDiv2"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"annotationLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"teacher feedback"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"annotationTextDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"annotationDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.states</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'> 43</span> </span><span class="NAME">this.states.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"responseBox"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">this.states</span><span class="PUNC">[</span><span class="NAME">this.states.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">response</span><span class="PUNC">,</span><span class="NAME">this.setSaveUnavailable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">displayNumberAttempts</span><span class="PUNC">(</span><span class="STRN">"This is your"</span><span class="PUNC">,</span><span class="STRN">"revision"</span><span class="PUNC">,</span><span class="NAME">this.states</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.node.setCompleted</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"numberAttemptsDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"This is your first revision."</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">c</span><span class="PUNC">!=</span><span class="STRN">""</span><span class="PUNC">)</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"responseBox"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.onlyDisplayMessage</span><span class="PUNC">(</span><span class="STRN">"&lt;p>To start this step you must first submit a response in step &lt;a style=\"color:blue\" onclick=\"eventManager.fire('renderNode', ['"</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'> 44</span> </span><span class="NAME">this.view.getProject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getPositionById</span><span class="PUNC">(</span><span class="NAME">this.associatedAnnotateNode.id</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"']) \">"</span><span class="PUNC">+</span><span class="NAME">d</span><span class="PUNC">+</span><span class="STRN">"&lt;/a>&lt;/b> (link).&lt;/p>"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.onlyDisplayMessage</span><span class="PUNC">(</span><span class="STRN">"&lt;p>To start this step you must first submit a response in step &lt;b>&lt;a style=\"color:blue\" onclick=\"eventManager.fire('renderNode', ['"</span><span class="PUNC">+</span><span class="NAME">this.view.getProject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getPositionById</span><span class="PUNC">(</span><span class="NAME">this.associatedStartNode.id</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"']) \">"</span><span class="PUNC">+</span><span class="NAME">c</span><span class="PUNC">+</span><span class="STRN">"&lt;/a>&lt;/b> (link).&lt;/p>"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.doneRendering</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 45</span> </span><span class="NAME">OPENRESPONSE.prototype.retrieveTeacherReview</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.view.annotations</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NAME">this.view.getAnnotations</span><span class="PUNC">(</span><span class="NAME">this.node.id</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">this.displayTeacherReview</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 46</span> </span><span class="NAME">OPENRESPONSE.prototype.retrieveOtherStudentWork</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">this.view.getConfig</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getConfigParam</span><span class="PUNC">(</span><span class="STRN">"getPeerReviewUrl"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">this.view.getConfig</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getConfigParam</span><span class="PUNC">(</span><span class="STRN">"runId"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">this.view.getUserAndClassInfo</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getWorkgroupId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">this.view.getUserAndClassInfo</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getPeriodId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">this.associatedStartNodeId</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">this.openPercentageTrigger</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">this.openNumberTrigger</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">this.openLogicTrigger</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">this.view.getUserAndClassInfo</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getWorkgroupIdsInClass</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.view.connectionManager.request</span><span class="PUNC">(</span><span class="STRN">"GET"</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">action</span><span class="PUNC">:</span><span class="STRN">"studentRequest"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 47</span> </span><span class="NAME">runId</span><span class="PUNC">:</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">workgroupId</span><span class="PUNC">:</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">periodId</span><span class="PUNC">:</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">nodeId</span><span class="PUNC">:</span><span class="NAME">f</span><span class="PUNC">,</span><span class="NAME">openPercentageTrigger</span><span class="PUNC">:</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">openNumberTrigger</span><span class="PUNC">:</span><span class="NAME">g</span><span class="PUNC">,</span><span class="NAME">openLogicTrigger</span><span class="PUNC">:</span><span class="NAME">h</span><span class="PUNC">,</span><span class="NAME">peerReviewAction</span><span class="PUNC">:</span><span class="STRN">"annotate"</span><span class="PUNC">,</span><span class="NAME">classmateWorkgroupIds</span><span class="PUNC">:</span><span class="NAME">i</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">this.retrieveOtherStudentWorkCallback</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="KEYW">this</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 48</span> </span><span class="NAME">OPENRESPONSE.prototype.retrieveOtherStudentWorkCallback</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">b.otherStudentNodeVisit</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">a</span><span class="PUNC">!=</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">$.parseJSON</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="NAME">b.associatedStartNode</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">b.view.getProject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getStepNumberAndTitle</span><span class="PUNC">(</span><span class="NAME">b.associatedStartNode.id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a.error</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a.error</span><span class="PUNC">==</span><span class="STRN">"peerReviewUserHasNotSubmittedOwnWork"</span><span class="PUNC">)</span><span class="NAME">b.onlyDisplayMessage</span><span class="PUNC">(</span><span class="STRN">"&lt;p>To start this step you must first submit a response in step &lt;b>&lt;a style=\"color:blue\" onclick=\"eventManager.fire('renderNode', ['"</span><span class="PUNC">+</span><span class="NAME">b.view.getProject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getPositionById</span><span class="PUNC">(</span><span class="NAME">b.associatedStartNode.id</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'> 49</span> </span><span class="STRN">"']) \">"</span><span class="PUNC">+</span><span class="NAME">c</span><span class="PUNC">+</span><span class="STRN">"&lt;/a>&lt;/b> (link).&lt;/p>"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a.error</span><span class="PUNC">==</span><span class="STRN">"peerReviewNotAbleToAssignWork"</span><span class="PUNC">||</span><span class="NAME">a.error</span><span class="PUNC">==</span><span class="STRN">"peerReviewNotOpen"</span><span class="PUNC">)</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">b.stepNotOpenCustomMessage</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">b.stepNotOpenCustomMessage</span><span class="PUNC">!=</span><span class="STRN">""</span><span class="PUNC">)</span><span class="NAME">b.onlyDisplayMessage</span><span class="PUNC">(</span><span class="NAME">b.stepNotOpenCustomMessage.replace</span><span class="PUNC">(</span><span class="REGX">/associatedStartNode.title/g</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">b.onlyDisplayMessage</span><span class="PUNC">(</span><span class="STRN">'&lt;p>This step is not available yet.&lt;/p>&lt;/p>&lt;p>More of your peers need to submit a response for step &lt;b>"'</span><span class="PUNC">+</span><span class="NAME">c</span><span class="PUNC">+</span><span class="STRN">'"&lt;/b>. &lt;br/>You will then be assigned a response to review.&lt;/p>&lt;p>Please return to this step again in a few minutes.&lt;/p>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 50</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a.error</span><span class="PUNC">==</span><span class="STRN">"peerReviewShowAuthoredWork"</span><span class="PUNC">)</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">b.content.authoredWork</span><span class="PUNC">,</span><span class="NAME">b.showAuthorContent</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">b.otherStudentWorkgroupId</span><span class="PUNC">=</span><span class="NAME">a.workgroupId</span><span class="PUNC">,</span><span class="NAME">b.otherStudentStepWorkId</span><span class="PUNC">=</span><span class="NAME">a.stepWorkId</span><span class="PUNC">,</span><span class="NAME">b.otherStudentNodeVisit</span><span class="PUNC">=</span><span class="NAME">a.nodeVisit</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">b.associatedStartNode.getPeerReviewOtherStudentWork</span><span class="PUNC">(</span><span class="NAME">b.otherStudentNodeVisit</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">b.replaceSlashNWithBR</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">b.showDefaultDivs</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">b.showDefaultValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"promptLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"instructions"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"responseLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"your feedback for &lt;i>Team Anonymous&lt;/i>:"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 51</span> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"originalPromptTextDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="NAME">b.associatedStartNode.getPeerReviewPrompt</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"originalPromptDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"work submitted by &lt;i>Team Anonymous&lt;/i>:"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkTextDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="NAME">b.setResponse</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">b.doneRendering</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 52</span> </span><span class="NAME">OPENRESPONSE.prototype.retrieveAnnotationAndWork</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">this.view.getConfig</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getConfigParam</span><span class="PUNC">(</span><span class="STRN">"getPeerReviewUrl"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">this.view.getConfig</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getConfigParam</span><span class="PUNC">(</span><span class="STRN">"runId"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">this.view.getUserAndClassInfo</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getWorkgroupId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">this.view.getUserAndClassInfo</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getPeriodId</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">this.associatedStartNodeId</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">this.view.getUserAndClassInfo</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getWorkgroupIdsInClass</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.view.connectionManager.request</span><span class="PUNC">(</span><span class="STRN">"GET"</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">action</span><span class="PUNC">:</span><span class="STRN">"studentRequest"</span><span class="PUNC">,</span><span class="NAME">runId</span><span class="PUNC">:</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">workgroupId</span><span class="PUNC">:</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">periodId</span><span class="PUNC">:</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">nodeId</span><span class="PUNC">:</span><span class="NAME">f</span><span class="PUNC">,</span><span class="NAME">peerReviewAction</span><span class="PUNC">:</span><span class="STRN">"revise"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 53</span> </span><span class="NAME">classmateWorkgroupIds</span><span class="PUNC">:</span><span class="NAME">e</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">this.retrieveAnnotationAndWorkCallback</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="KEYW">this</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 54</span> </span><span class="NAME">OPENRESPONSE.prototype.retrieveAnnotationAndWorkCallback</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">a</span><span class="PUNC">!=</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">$.parseJSON</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="NAME">b.associatedStartNode</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">b.view.getProject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getStepNumberAndTitle</span><span class="PUNC">(</span><span class="NAME">b.associatedStartNode.id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="NAME">b.associatedAnnotateNode</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">b.view.getProject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getStepNumberAndTitle</span><span class="PUNC">(</span><span class="NAME">b.associatedAnnotateNode.id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a.error</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a.error</span><span class="PUNC">==</span><span class="STRN">"peerReviewUserHasNotSubmittedOwnWork"</span><span class="PUNC">)</span><span class="NAME">b.onlyDisplayMessage</span><span class="PUNC">(</span><span class="STRN">"&lt;p>To start this step you must first submit a response in step &lt;b>&lt;a style=\"color:blue\" onclick=\"eventManager.fire('renderNode', ['"</span><span class="PUNC">+</span><span class="NAME">b.view.getProject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getPositionById</span><span class="PUNC">(</span><span class="NAME">b.associatedStartNode.id</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'> 55</span> </span><span class="STRN">"']) \">"</span><span class="PUNC">+</span><span class="NAME">c</span><span class="PUNC">+</span><span class="STRN">"&lt;/a>&lt;/b> (link).&lt;/p>"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a.error</span><span class="PUNC">==</span><span class="STRN">"peerReviewUserHasNotBeenAssignedToClassmateWork"</span><span class="PUNC">)</span><span class="NAME">b.onlyDisplayMessage</span><span class="PUNC">(</span><span class="STRN">'&lt;p>This step is not available yet.&lt;/p>&lt;/p>&lt;p>More of your peers need to submit a response for step &lt;b>"'</span><span class="PUNC">+</span><span class="NAME">c</span><span class="PUNC">+</span><span class="STRN">'"&lt;/b>. &lt;br/>You will then be assigned a response to review.&lt;/p>&lt;p>Please return to step "'</span><span class="PUNC">+</span><span class="NAME">d</span><span class="PUNC">+</span><span class="STRN">'" in a few minutes.&lt;/p>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a.error</span><span class="PUNC">==</span><span class="STRN">"peerReviewUserHasNotAnnotatedClassmateWork"</span><span class="PUNC">)</span><span class="NAME">b.onlyDisplayMessage</span><span class="PUNC">(</span><span class="STRN">"&lt;p>To start this step you must first submit a response in step &lt;a style=\"color:blue\" onclick=\"eventManager.fire('renderNode', ['"</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'> 56</span> </span><span class="NAME">b.view.getProject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getPositionById</span><span class="PUNC">(</span><span class="NAME">b.associatedAnnotateNode.id</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"']) \">"</span><span class="PUNC">+</span><span class="NAME">d</span><span class="PUNC">+</span><span class="STRN">"&lt;/a>&lt;/b> (link).&lt;/p>"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a.error</span><span class="PUNC">==</span><span class="STRN">"peerReviewUserWorkHasNotBeenAssignedToClassmate"</span><span class="PUNC">||</span><span class="NAME">a.error</span><span class="PUNC">==</span><span class="STRN">"peerReviewUserWorkHasNotBeenAnnotatedByClassmate"</span><span class="PUNC">)</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">b.stepNotOpenCustomMessage</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">b.stepNotOpenCustomMessage</span><span class="PUNC">!=</span><span class="STRN">""</span><span class="PUNC">)</span><span class="NAME">b.onlyDisplayMessage</span><span class="PUNC">(</span><span class="NAME">b.stepNotOpenCustomMessage.replace</span><span class="PUNC">(</span><span class="REGX">/associatedStartNode.title/g</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/associatedAnnotateNode.title/g</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">b.onlyDisplayMessage</span><span class="PUNC">(</span><span class="STRN">'&lt;p>This step is not available yet.&lt;/p>&lt;p>Your response in step &lt;b>"'</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'> 57</span> </span><span class="NAME">c</span><span class="PUNC">+</span><span class="STRN">'"&lt;/b> has not been reviewed by a peer yet.&lt;/p>&lt;p>More of your peers need to submit a response for step &lt;b>"'</span><span class="PUNC">+</span><span class="NAME">d</span><span class="PUNC">+</span><span class="STRN">'"&lt;/b>.&lt;/p>&lt;p>Please return to this step in a few minutes.&lt;/p>'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a.error</span><span class="PUNC">==</span><span class="STRN">"peerReviewShowAuthoredReview"</span><span class="PUNC">)</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">b.view.getStudentWorkForNodeId</span><span class="PUNC">(</span><span class="NAME">b.associatedAnnotateNode.id</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">b.view.isLatestNodeStateLocked</span><span class="PUNC">(</span><span class="NAME">b.associatedAnnotateNode.id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">b.content.authoredReview</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">b.onlyDisplayMessage</span><span class="PUNC">(</span><span class="STRN">"&lt;p>To start this step you must first submit a response in step &lt;a style=\"color:blue\" onclick=\"eventManager.fire('renderNode', ['"</span><span class="PUNC">+</span><span class="WHIT">
<span class='line'> 58</span> </span><span class="NAME">b.view.getProject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getPositionById</span><span class="PUNC">(</span><span class="NAME">b.associatedAnnotateNode.id</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"']) \">"</span><span class="PUNC">+</span><span class="NAME">d</span><span class="PUNC">+</span><span class="STRN">"&lt;/a>.&lt;/p>"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">a.annotation.value</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">b.replaceSlashNWithBR</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">NODE_VISIT.prototype.parseDataJSONObj</span><span class="PUNC">(</span><span class="NAME">a.nodeVisit</span><span class="PUNC">,</span><span class="NAME">b.view</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getLatestWork</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">b.replaceSlashNWithBR</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">b.showDefaultDivs</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">b.showDefaultValues</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"promptLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"instructions"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"responseLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"your second draft:"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"originalPromptTextDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="WHIT">
<span class='line'> 59</span> </span><span class="NAME">b.associatedStartNodeContent.assessmentItem.interaction.prompt</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"originalPromptDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">'your original response&nbsp;&nbsp;&nbsp;&lt;a id="toggleSwitch" onclick="toggleDetails2()">show/hide text'</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkTextDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkTextDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 60</span> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"associatedWorkTextDiv2"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"annotationLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"&lt;i>Team Anonymous&lt;/i> has given you the following feedback:"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"annotationTextDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"annotationDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">b.states</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">b.states.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"responseBox"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">b.states</span><span class="PUNC">[</span><span class="NAME">b.states.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">response</span><span class="PUNC">,</span><span class="NAME">b.setSaveUnavailable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">displayNumberAttempts</span><span class="PUNC">(</span><span class="STRN">"This is your"</span><span class="PUNC">,</span><span class="STRN">"revision"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 61</span> </span><span class="NAME">b.states</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">b.node.setCompleted</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"numberAttemptsDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"This is your first revision."</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">a</span><span class="PUNC">!=</span><span class="STRN">""</span><span class="PUNC">)</span><span class="NAME">b.richTextEditor</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NAME">a.constructor.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">"Array"</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">?</span><span class="NAME">b.richTextEditor.setContent</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">b.richTextEditor.setContent</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"responseBox"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">}</span><span class="NAME">b.doneRendering</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 62</span> </span><span class="NAME">OPENRESPONSE.prototype.showStarter</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.content.starterSentence.display</span><span class="PUNC">!=</span><span class="STRN">"0"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"responseBox"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.richTextEditor</span><span class="PUNC">?</span><span class="NAME">this.richTextEditor.setContent</span><span class="PUNC">(</span><span class="NAME">this.content.starterSentence.sentence</span><span class="PUNC">+</span><span class="STRN">"&lt;br/>&lt;br/>"</span><span class="PUNC">+</span><span class="NAME">this.richTextEditor.getContent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">a.value</span><span class="PUNC">=</span><span class="NAME">this.content.starterSentence.sentence</span><span class="PUNC">+</span><span class="STRN">"\n\n"</span><span class="PUNC">+</span><span class="NAME">a.value</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.node.view.notificationManager.notify</span><span class="PUNC">(</span><span class="STRN">"There is no starter sentence specified for this step"</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 63</span> </span><span class="NAME">OPENRESPONSE.prototype.getPeerReviewPrompt</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="NAME">this.content</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">this.content.assessmentItem</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.content.assessmentItem.interaction.prompt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OPENRESPONSE.prototype.getPeerReviewOtherStudentWork</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">a.nodeStates</span><span class="PUNC">,</span><span class="NAME">a.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">a.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">response</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">b</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"&lt;p>Responses from your peers are not available yet.&lt;/p>&lt;p>Please return to this step later.&lt;/p>"</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 64</span> </span><span class="NAME">OPENRESPONSE.prototype.lockResponseBox</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"responseBox"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">disabled</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OPENRESPONSE.prototype.unlockResponseBox</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"responseBox"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">disabled</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 65</span> </span><span class="NAME">OPENRESPONSE.prototype.showDefaultDivs</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"promptDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"starterParent"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"responseDisplayDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"buttonDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 66</span> </span><span class="NAME">OPENRESPONSE.prototype.showDefaultValues</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.content.starterSentence.display</span><span class="PUNC">==</span><span class="STRN">"1"</span><span class="PUNC">||</span><span class="NAME">this.content.starterSentence.display</span><span class="PUNC">==</span><span class="STRN">"2"</span><span class="PUNC">?</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"starterParent"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"block"</span><span class="PUNC">:</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"starterParent"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">style.display</span><span class="PUNC">=</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"orPromptDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="NAME">this.content.assessmentItem.interaction.prompt</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"promptLabelDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"question"</span><span class="PUNC">;</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"responseBox"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setAttribute</span><span class="PUNC">(</span><span class="STRN">"rows"</span><span class="PUNC">,</span><span class="NAME">this.content.assessmentItem.interaction.expectedLines</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 67</span> </span><span class="NAME">OPENRESPONSE.prototype.appendResponse</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.content.isRichTextEditorAllowed</span><span class="PUNC">?</span><span class="NAME">this.richTextEditor.setContent</span><span class="PUNC">(</span><span class="NAME">this.richTextEditor.getContent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"responseBox"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 68</span> </span><span class="NAME">OPENRESPONSE.prototype.setResponse</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.states</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">&&</span><span class="NAME">this.states.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">?</span><span class="PUNC">(</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"responseBox"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">this.states</span><span class="PUNC">[</span><span class="NAME">this.states.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">response</span><span class="PUNC">,</span><span class="NAME">this.setSaveUnavailable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">displayNumberAttempts</span><span class="PUNC">(</span><span class="STRN">"This is your"</span><span class="PUNC">,</span><span class="STRN">"revision"</span><span class="PUNC">,</span><span class="NAME">this.states</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"numberAttemptsDiv"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="PUNC">=</span><span class="STRN">"This is your first revision."</span><span class="PUNC">,</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"responseBox"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">this.setSaveAvailable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.content.starterSentence.display</span><span class="PUNC">==</span><span class="STRN">"2"</span><span class="PUNC">&&</span><span class="NAME">this.showStarter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 69</span> </span><span class="NAME">OPENRESPONSE.prototype.replaceSlashNWithBR</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">a.constructor.toString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">"Array"</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">?</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="NAME">a</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b.replace</span><span class="PUNC">(</span><span class="REGX">/\n/g</span><span class="PUNC">,</span><span class="STRN">"&lt;br>"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">OPENRESPONSE.prototype.doneRendering</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">eventManager.fire</span><span class="PUNC">(</span><span class="STRN">"contentRenderComplete"</span><span class="PUNC">,</span><span class="NAME">this.node.id</span><span class="PUNC">,</span><span class="NAME">this.node</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">eventManager</span><span class="PUNC">!=</span><span class="STRN">"undefined"</span><span class="PUNC">&&</span><span class="NAME">eventManager.fire</span><span class="PUNC">(</span><span class="STRN">"scriptLoaded"</span><span class="PUNC">,</span><span class="STRN">"vle/node/openresponse/openresponse.js"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 70</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">eventManager</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">eventManager.fire</span><span class="PUNC">(</span><span class="STRN">'scriptLoaded'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'vle/node/openresponse/openresponse_core_min.js'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 71</span> </span></pre></body></html>