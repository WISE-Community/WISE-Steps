<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">LZ77</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">a.referenceIntBase</span><span class="PUNC">||</span><span class="NUMB">96</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">=</span><span class="STRN">" "</span><span class="PUNC">.</span><span class="NAME">charCodeAt</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">a.minStringLength</span><span class="PUNC">||</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NAME">j</span><span class="PUNC">=</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">+</span><span class="NAME">f</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">a.defaultWindowLength</span><span class="PUNC">||</span><span class="NUMB">144</span><span class="PUNC">,</span><span class="NAME">m</span><span class="PUNC">=</span><span class="NAME">g</span><span class="PUNC">+</span><span class="NAME">f</span><span class="PUNC">,</span><span class="NAME">k</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">a</span><span class="PUNC">&lt;</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">;</span><span class="PUNC">)</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">String.fromCharCode</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">%</span><span class="NAME">b</span><span class="PUNC">+</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">h</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">/</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">-</span><span class="NAME">h.length</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">f</span><span class="PUNC">&lt;</span><span class="NAME">n</span><span class="PUNC">;</span><span class="NAME">f</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">String.fromCharCode</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">h</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="STRN">"Reference int out of range: "</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">+</span><span class="STRN">" (width = "</span><span class="PUNC">+</span><span class="NAME">c</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">r</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">n</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">n</span><span class="PUNC">&lt;</span><span class="NAME">f</span><span class="PUNC">;</span><span class="NAME">n</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">h</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">a.charCodeAt</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">>=</span><span class="NAME">d</span><span class="PUNC">&&</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="NAME">e</span><span class="PUNC">&lt;=</span><span class="NAME">c</span><span class="PUNC">)</span><span class="NAME">h</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">e</span><span class="PUNC">-</span><span class="NAME">d</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="STRN">"Invalid char code in reference int: "</span><span class="PUNC">+</span><span class="NAME">e</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.compress</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">||</span><span class="NAME">e</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">></span><span class="NAME">m</span><span class="PUNC">)</span><span class="KEYW">throw</span><span class="STRN">"Window length too large"</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">s</span><span class="PUNC">=</span><span class="NAME">a.length</span><span class="PUNC">-</span><span class="NAME">f</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">&lt;</span><span class="NAME">s</span><span class="PUNC">;</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">-</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">f</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">l</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">distance</span><span class="PUNC">:</span><span class="NAME">g</span><span class="PUNC">,</span><span class="NAME">length</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">q</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">o</span><span class="PUNC">+</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">c</span><span class="PUNC">;</span><span class="PUNC">)</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a.substr</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NAME">a.substr</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">j</span><span class="PUNC">)</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">i</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">&&</span><span class="NAME">i</span><span class="PUNC">></span><span class="NAME">l.length</span><span class="PUNC">)</span><span class="NAME">l.distance</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">-</span><span class="NAME">o</span><span class="PUNC">-</span><span class="NAME">i</span><span class="PUNC">,</span><span class="NAME">l.length</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">f</span><span class="PUNC">;</span><span class="NAME">o</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="NAME">p</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="NAME">l.length</span><span class="PUNC">?</span><span class="PUNC">(</span><span class="NAME">q</span><span class="PUNC">=</span><span class="STRN">"`"</span><span class="PUNC">+</span><span class="NAME">k</span><span class="PUNC">(</span><span class="NAME">l.distance</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">k</span><span class="PUNC">(</span><span class="NAME">l.length</span><span class="PUNC">-</span><span class="NAME">f</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">l.length</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">q</span><span class="PUNC">=</span><span class="NAME">a.charAt</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="STRN">"`"</span><span class="PUNC">?</span><span class="NAME">a.charAt</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="STRN">"``"</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">q</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">+</span><span class="NAME">a.slice</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/`/g</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>  3</span> </span><span class="STRN">"``"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this.decompress</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">&lt;</span><span class="NAME">a.length</span><span class="PUNC">;</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">a.charAt</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">!=</span><span class="STRN">"`"</span><span class="PUNC">)</span><span class="NAME">b</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a.charAt</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="STRN">"`"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">r</span><span class="PUNC">(</span><span class="NAME">a.substr</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">a.charAt</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">r</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">f</span><span class="PUNC">;</span><span class="NAME">b</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">b.substr</span><span class="PUNC">(</span><span class="NAME">b.length</span><span class="PUNC">-</span><span class="NAME">d</span><span class="PUNC">-</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">f</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"`"</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">eventManager</span><span class="PUNC">!=</span><span class="STRN">"undefined"</span><span class="PUNC">&&</span><span class="NAME">eventManager.fire</span><span class="PUNC">(</span><span class="STRN">"scriptLoaded"</span><span class="PUNC">,</span><span class="STRN">"vle/node/draw/svg-edit/lz77.js"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Utils</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">_keyStr</span><span class="PUNC">:</span><span class="STRN">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="</span><span class="PUNC">,</span><span class="NAME">encode64</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">Utils.convertToXMLReferences</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">window.btoa</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">window.btoa</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">a.length</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">,</span><span class="NAME">j</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">m</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">k</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">do</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">a.charCodeAt</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">a.charCodeAt</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">a.charCodeAt</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">>></span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">&</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">&lt;&lt;</span><span class="NUMB">4</span><span class="PUNC">|</span><span class="NAME">c</span><span class="PUNC">>></span><span class="NUMB">4</span><span class="PUNC">,</span><span class="NAME">j</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">&</span><span class="NUMB">15</span><span class="PUNC">)</span><span class="PUNC">&lt;&lt;</span><span class="NUMB">2</span><span class="PUNC">|</span><span class="NAME">g</span><span class="PUNC">>></span><span class="NUMB">6</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">g</span><span class="PUNC">&</span><span class="NUMB">63</span><span class="PUNC">,</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">j</span><span class="PUNC">=</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NUMB">64</span><span class="PUNC">:</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NUMB">64</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">this._keyStr.charAt</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">this._keyStr.charAt</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">this._keyStr.charAt</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">this._keyStr.charAt</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  4</span> </span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">&lt;</span><span class="NAME">a.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b.join</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">decode64</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">window.atob</span><span class="PUNC">)</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">window.atob</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">,</span><span class="NAME">j</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">a.replace</span><span class="PUNC">(</span><span class="REGX">/[^A-Za-z0-9\+\/\=]/g</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">do</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">this._keyStr.indexOf</span><span class="PUNC">(</span><span class="NAME">a.charAt</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">this._keyStr.indexOf</span><span class="PUNC">(</span><span class="NAME">a.charAt</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">this._keyStr.indexOf</span><span class="PUNC">(</span><span class="NAME">a.charAt</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">j</span><span class="PUNC">=</span><span class="NAME">this._keyStr.indexOf</span><span class="PUNC">(</span><span class="NAME">a.charAt</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">&lt;&lt;</span><span class="NUMB">2</span><span class="PUNC">|</span><span class="NAME">c</span><span class="PUNC">>></span><span class="NUMB">4</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">&</span><span class="NUMB">15</span><span class="PUNC">)</span><span class="PUNC">&lt;&lt;</span><span class="NUMB">4</span><span class="PUNC">|</span><span class="NAME">f</span><span class="PUNC">>></span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">&</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">&lt;&lt;</span><span class="NUMB">6</span><span class="PUNC">|</span><span class="NAME">j</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">String.fromCharCode</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">!=</span><span class="NUMB">64</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">String.fromCharCode</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">j</span><span class="PUNC">!=</span><span class="NUMB">64</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">String.fromCharCode</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">&lt;</span><span class="NAME">a.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">unescape</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">encodeUTF8</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="WHIT">
<span class='line'>  5</span> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">&lt;</span><span class="NAME">a.length</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">a.charCodeAt</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">&lt;</span><span class="NUMB">128</span><span class="PUNC">?</span><span class="NAME">b</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="NAME">c</span><span class="PUNC">></span><span class="NUMB">127</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">&lt;</span><span class="NUMB">2048</span><span class="PUNC">?</span><span class="NAME">String.fromCharCode</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">>></span><span class="NUMB">6</span><span class="PUNC">|</span><span class="NUMB">192</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">String.fromCharCode</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">>></span><span class="NUMB">12</span><span class="PUNC">|</span><span class="NUMB">224</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">String.fromCharCode</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">>></span><span class="NUMB">6</span><span class="PUNC">&</span><span class="NUMB">63</span><span class="PUNC">|</span><span class="NUMB">128</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">String.fromCharCode</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">&</span><span class="NUMB">63</span><span class="PUNC">|</span><span class="NUMB">128</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">convertToXMLReferences</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">&lt;</span><span class="NAME">a.length</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">a.charCodeAt</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">&lt;</span><span class="NUMB">128</span><span class="PUNC">?</span><span class="NAME">b</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="NAME">c</span><span class="PUNC">></span><span class="NUMB">127</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"&#"</span><span class="PUNC">+</span><span class="NAME">c</span><span class="PUNC">+</span><span class="STRN">";"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">rectsIntersect</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b.x</span><span class="PUNC">&lt;</span><span class="NAME">a.x</span><span class="PUNC">+</span><span class="NAME">a.width</span><span class="PUNC">&&</span><span class="NAME">b.x</span><span class="PUNC">+</span><span class="NAME">b.width</span><span class="PUNC">></span><span class="NAME">a.x</span><span class="PUNC">&&</span><span class="NAME">b.y</span><span class="PUNC">&lt;</span><span class="NAME">a.y</span><span class="PUNC">+</span><span class="NAME">a.height</span><span class="PUNC">&&</span><span class="NAME">b.y</span><span class="PUNC">+</span><span class="NAME">b.height</span><span class="PUNC">></span><span class="NAME">a.y</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">text2xml</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">;</span><span class="KEYW">try</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">$.browser.msie</span><span class="PUNC">?</span><span class="WHIT">
<span class='line'>  6</span> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ActiveXObject</span><span class="PUNC">(</span><span class="STRN">"Microsoft.XMLDOM"</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DOMParser</span><span class="PUNC">;</span><span class="NAME">d.async</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">"XML Parser could not be instantiated"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">try</span><span class="PUNC">{</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">$.browser.msie</span><span class="PUNC">?</span><span class="NAME">d.loadXML</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">d</span><span class="PUNC">:</span><span class="PUNC">!</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">d.parseFromString</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="STRN">"text/xml"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">"Error parsing XML string"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">eventManager</span><span class="PUNC">!=</span><span class="STRN">"undefined"</span><span class="PUNC">&&</span><span class="NAME">eventManager.fire</span><span class="PUNC">(</span><span class="STRN">"scriptLoaded"</span><span class="PUNC">,</span><span class="STRN">"vle/node/draw/svg-edit/utils.js"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">SVGDRAWSTATE</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.type</span><span class="PUNC">=</span><span class="STRN">"html"</span><span class="PUNC">;</span><span class="NAME">this.data</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">;</span><span class="NAME">this.timestamp</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">b</span><span class="PUNC">}</span><span class="NAME">SVGDRAWSTATE.prototype.parseDataJSONObj</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">SVGDRAWSTATE</span><span class="PUNC">;</span><span class="NAME">b.data</span><span class="PUNC">=</span><span class="NAME">a.data</span><span class="PUNC">;</span><span class="NAME">b.timestamp</span><span class="PUNC">=</span><span class="NAME">a.timestamp</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">SVGDRAWSTATE.prototype.getStudentWork</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.data</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">eventManager</span><span class="PUNC">!=</span><span class="STRN">"undefined"</span><span class="PUNC">&&</span><span class="NAME">eventManager.fire</span><span class="PUNC">(</span><span class="STRN">"scriptLoaded"</span><span class="PUNC">,</span><span class="STRN">"vle/node/draw/svg-edit/svgdrawstate.js"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  7</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">eventManager</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">eventManager.fire</span><span class="PUNC">(</span><span class="STRN">'scriptLoaded'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'vle/node/draw/svgdraw_grading_min.js'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>  8</span> </span></pre></body></html>